<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@200;500&display=swap" rel="stylesheet">
    <script src='https://cdn.plot.ly/plotly-2.6.3.min.js'></script>
    <style>
        html, body {
            height: 100%;
            margin: 0;
            background-color: #000;
            color: white;
            font-family: 'Montserrat', sans-serif;
        }
      
        video {
            width: 600px;
            height: 400px;
        }
      
        #header_videos {
            text-align: center;
            font-weight: 500;
        }
        #selector_header{
            font-weight: 200;
        }
        .divider{
            width: 1000px;
            height: 1px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.548);
        }
        buttonrow
        {
            display:inline;
        }
        #figures{
            display: flex;
            flex-direction: row;
            justify-content: center;
            align-items: center;
            flex-flow: row wrap;
        }
      
        /* Style the tab */
      .tab {
      overflow: hidden;
      border: 1px solid #ccc;
      background-color: #54595f;
      }
      
      /* Style the buttons inside the tab */
      .tab button {
      background-color: inherit;
      float: left;
      border: none;
      outline: none;
      cursor: pointer;
      padding: 14px 16px;
      transition: 0.3s;
      font-size: 17px;
      color: white;
      }
      
      /* Change background color of buttons on hover */
      .tab button:hover {
      background-color: #909090;
      }
      
      /* Create an active/current tablink class */
      .tab button.active {
      background-color: #838383;
      }
      
      /* Style the tab content */
      .tabcontent {
      display: none;
      padding: 6px 12px;
      border: 1px solid #ccc;
      border-top: none;
      background-color: #000;
      }
  
      .mediatabcontent {
          display: none;
          padding: 0 px 0 px;
          border: 1px solid #ccc;
          border-top: none;
          background-color: #000;
          width: 100%;
          height: 100%;
      }
      
      /* Style the close button */
      .topright {
      float: right;
      cursor: pointer;
      font-size: 28px;
      }
      
      .topright:hover {color: red;}
    </style>
    </head>
<body>

<div class="tab">
  <button class="tablinks" onclick="openTab(event, 'Environment')" id="defaultOpen">Environment</button>
  <button class="tablinks" onclick="openTab(event, 'Hyperparameters')">Hyperparameters</button>
  <button class="tablinks" onclick="openTab(event, 'Model')">Model</button>
  <button class="tablinks" onclick="openTab(event, 'Media')">Media</button>
</div>

<div id="Environment" class="tabcontent">
  <span onclick="this.parentElement.style.display='none'" class="topright">&times</span>
  <b>type</b>: CartPole<br><b>name</b>: CartPole-v0<br><b>frame_skip</b>: 1<br><b>last_action_to_obs</b>: False<br><b>last_reward_to_obs</b>: False<br><b>obs_stacks</b>: 1<br><b>grayscale</b>: False<br><b>resize_vis_obs</b>: [84, 84]<br><b>reset_params</b>: <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>start-seed</b>: 0<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>num-seeds</b>: 100<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>mask-velocity</b>: True<br>
</div>

<div id="Model" class="tabcontent">
  <span onclick="this.parentElement.style.display='none'" class="topright">&times</span>
  <b>load_model</b>: False<br><b>model_path</b>: ./checkpoints/cartpole/20210722-103713_2/cartpole-199.pt<br><b>checkpoint_interval</b>: 25<br><b>activation</b>: relu<br><b>vis_encoder</b>: cnn<br><b>vec_encoder</b>: linear<br><b>num_vec_encoder_units</b>: 128<br><b>hidden_layer</b>: default<br><b>num_hidden_layers</b>: 1<br><b>num_hidden_units</b>: 512<br><b>recurrence</b>: <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>layer_type</b>: gru<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>sequence_length</b>: 16<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>hidden_state_size</b>: 128<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>hidden_state_init</b>: zero<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>reset_hidden_state</b>: False<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>residual</b>: False<br>
</div>

<div id="Hyperparameters" class="tabcontent">
  <span onclick="this.parentElement.style.display='none'" class="topright">&times</span>
  <b>algorithm</b>: PPO<br><b>resume_at</b>: 0<br><b>gamma</b>: 0.99<br><b>lamda</b>: 0.95<br><b>updates</b>: 200<br><b>epochs</b>: 4<br><b>n_mini_batches</b>: 4<br><b>value_coefficient</b>: 0.25<br><b>max_grad_norm</b>: 0.5<br><b>share_parameters</b>: True<br><b>learning_rate_schedule</b>: <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>initial</b>: 0.0001<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>final</b>: 0.0001<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>power</b>: 1.0<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>max_decay_steps</b>: 50<br><b>beta_schedule</b>: <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>initial</b>: 1e-05<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>final</b>: 1e-06<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>power</b>: 1.0<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>max_decay_steps</b>: 50<br><b>clip_range_schedule</b>: <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>initial</b>: 0.2<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>final</b>: 0.2<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>power</b>: 1.0<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>max_decay_steps</b>: 50<br>
</div>

<div id="Media" class="mediatabcontent">
    <div id='video_section'>
      <div id='figures'>
          <video id='video_player'>
              <source src="videos/video_seed_1001_1.webm"type="video/webm">
          </video>
          <div id='action_distr'></div>
      </div>
  </div>

  <br>
  <center>
    <buttonrow>
        <button id="play_button" onclick="play()">Play</button>
        <button id="pause_button" onclick="pause()">Pause</button>
        <button id="reset_button" onclick="reset()">Reset</button>
        <button id="back_button" onclick="back()">Back</button>
        <button id="next_button" onclick="next()">Next</button>
    </buttonrow>

    <h3 id="selector_header">Timeline</h3>
        <input id='time_selector' type='range' min = 0 max = 100 step = 1>
        <div id='video_section'>
            <div id='figures'>
            <div id='value_func'></div>
            <div id='entropy_func'></div>
        </div>
    </div>
    </center>
</div>

  <script>
    function openTab(evt, id) {
        var i, tabcontent, tablinks;
        tabcontent = document.getElementsByClassName("tabcontent");
        mediatabcontent = document.getElementsByClassName("mediatabcontent");
        for (i = 0; i < mediatabcontent.length; i++) {
            mediatabcontent[i].style.display = "none";
        }
        for (i = 0; i < tabcontent.length; i++) {
            tabcontent[i].style.display = "none";
        }
        tablinks = document.getElementsByClassName("tablinks");
        for (i = 0; i < tablinks.length; i++) {
            tablinks[i].className = tablinks[i].className.replace(" active", "");
        }
        document.getElementById(id).style.display = "block";
        evt.currentTarget.className += " active";
        }

  function openMediaSite() {
      window.open("video.html");
  }

  function color_red(x) {
      x.style.color = "red";
  }

  function color_white(x) {
      x.style.color = "white";
  }
  // Get the element with id="defaultOpen" and click on it
  document.getElementById("defaultOpen").click();


  // Media tab
  const video_player = document.getElementById("video_player");
  var video_length = 0;

  const timeSelector = document.getElementById('time_selector');
  var tS_max_value = 0;
  var tS_step_size = 0;

  var y_values = [0.11599999666213989, 0.12800000607967377, 0.12700000405311584, 0.125, 0.12300000339746475, 0.12099999934434891, 0.11699999868869781, 0.11500000208616257, 0.1120000034570694, 0.10899999737739563, 0.10700000077486038, 0.10400000214576721, 0.10100000351667404];
  var y_entropy = [0.692986011505127, 0.6930184364318848, 0.6930451393127441, 0.6930643320083618, 0.6930762529373169, 0.6930817365646362, 0.6930829286575317, 0.6930819749832153, 0.6930798888206482, 0.6930773854255676, 0.6930743455886841, 0.693070650100708, 0.6930661201477051];
  var y_action = [[[0.5089747309684753, 0.49102523922920227]], [[0.508022129535675, 0.49197787046432495]], [[0.5071443319320679, 0.4928556978702545]], [[0.5064340829849243, 0.4935658574104309]], [[0.5059573650360107, 0.49404263496398926]], [[0.5057213306427002, 0.4942786395549774]], [[0.5056673288345337, 0.4943326711654663]], [[0.5057074427604675, 0.49429258704185486]], [[0.5058022737503052, 0.4941977262496948]], [[0.5059084296226501, 0.49409160017967224]], [[0.5060344338417053, 0.4939655065536499]], [[0.5061866641044617, 0.4938134253025055]], [[0.5063669085502625, 0.49363309144973755]]];
  var action =  [[1], [1], [1], [0], [1], [0], [1], [0], [1], [1], [1], [1], [0]];
  var action_names = ['move right', 'move left'];

  window.addEventListener('load', () => {
      video_length = video_player.duration - 0.9999;
      tS_max_value = video_length;
      tS_step_size = 1.;
      timeSelector.value = 0;
      timeSelector.setAttribute('max', tS_max_value);
      timeSelector.setAttribute('step', tS_step_size);

      video_player.addEventListener('timeupdate', timeListener);
      video_player.addEventListener('dblclick', function(e) {open_fullscreen(video_player);});
      reset();
  }, false)

  timeSelector.addEventListener('input', () => {
      time = video_length / tS_max_value * timeSelector.value
      video_player.currentTime = time
      if(video_player.currentTime == Math.round(video_player.currentTime))
          video_player.currentTime += 0.0001
      video_player.currentTime = Math.min(video_player.currentTime, video_length);
      update_plots();
      pause();
  })

  function timeListener() {
      video_player.currentTime = Math.min(video_player.currentTime, video_length);
      if(video_player.currentTime == Math.round(video_player.currentTime))
          video_player.currentTime += 0.0001
      timeSelector.value = video_player.currentTime;
      update_plots();
  }

  function pause() {
      video_player.pause();
  }

  function play() {
      video_player.play();
  }

  function reset() {
      video_player.currentTime = 0.0001;
      update_plots();
      pause();
  }

  function back() {
      video_player.currentTime = video_player.currentTime - tS_step_size
      if(video_player.currentTime == Math.round(video_player.currentTime))
          video_player.currentTime += 0.0001
      update_plots();
      pause();
  }

  function next() {
      video_player.currentTime = video_player.currentTime + tS_step_size;
      video_player.currentTime = Math.min(video_player.currentTime, video_length);
      update_plots();
      pause();
  }

  function open_fullscreen(vid_elem) {
      if (vid_elem.requestFullscreen) {
          vid_elem.requestFullscreen();
      } else if (vid_elem.webkitRequestFullscreen) { /* Safari */
          vid_elem.webkitRequestFullscreen();
      } else if (vid_elem.msRequestFullscreen) { /* IE11 */
          vid_elem.msRequestFullscreen();
      }
      vid_elem.pause();
  }

  function update_plots()  {
    step = Math.floor(video_player.currentTime);
    set_scatter_line_plot('value_func', "Value Function", y_values, step);
    set_scatter_line_plot('entropy_func', "Entropy Function", y_entropy, step);
    if(action[0].length == 1)
      set_bar_action_plot(y_action[step][0], action[step][0], action_names);
}

  function set_bar_action_plot(y_values, action, action_names) {
      var bar_plot_layout_action = {
          autosize: true,
          width: 600,
          height: 360,
          margin: {
              l: 28,
              r: 0,
              b: 30,
              t: 22,
              pad: 4
            },
          plot_bgcolor: '#000',
          paper_bgcolor: '#000',
          font: {
              family: 'Montserrat',
              size: 12,
              color: '#fff'
          },
          title: {
              text: 'Action Distribution',
              font: {
                  family: 'Montserrat',
                  size: 15,
                  color: '#fff'
              }
          }
    };
      
      var color_value = new Array(y_values.length).fill('#FAEBD7');
      color_value[action] = '#FF0000';

      var bar_plot_data_action = [
          {
              x: action_names,
              y: y_values,
              type: 'bar',
              marker: {
                  color: color_value
              },
              textposition: 'auto',
              text: y_values.map(String),
              textfont: {
                  family: 'Montserrat',
                  size: 12,
              },
              textangle: 0,
              textposition: 'bottom center',
          }
      ];

      Plotly.newPlot('action_distr', bar_plot_data_action, bar_plot_layout_action);
  }

  function set_scatter_line_plot(id, title, y_values, N) {
      var line__scatter_plot_layout_value = {
          autosize: true,
          width: 600,
          height: 360,
          margin: {
              l: 50,
              r: 0,
              b: 30,
              t: 25,
              pad: 4
              },
          yaxis: {
              automargin: true
          },
          plot_bgcolor: '#000',
          paper_bgcolor: '#000',
          font: {
              family: 'Montserrat',
              size: 12,
              color: '#fff'
          },
          title: {
              text: title,
              font: {
                  family: 'Montserrat',
                  size: 15,
                  color: '#fff'
              }
          },
          showlegend: false,
      };

      var x_values = [...Array(y_values.length).keys()];

      var x_values_marker = x_values.slice(0, N + 1);
      var y_values_marker = y_values.slice(0, N + 1);

      var line_scatter_plot_data_value = [
          {
              x: x_values_marker,
              y: y_values_marker,
              mode: 'line',
              line: {
                  color: '#FAEBD7'
              },
          },
          {
              x: x_values,
              y: y_values,
              mode: 'markers',
              marker: {
                  color: '#7CFC00'
              },
          }
      ];

      Plotly.newPlot(id, line_scatter_plot_data_value, line__scatter_plot_layout_value);
  }
  </script>
   
</body>
</html> 